<svg width="860" height="360" viewBox="0 0 860 360" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="dfBg" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#0f0721" />
      <stop offset="100%" style="stop-color:#1a0a3d" />
    </linearGradient>
    <marker id="arr" markerWidth="9" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 9 3.5, 0 7" fill="#EC4899" opacity="0.8"/>
    </marker>
    <marker id="arrG" markerWidth="9" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 9 3.5, 0 7" fill="#10B981" opacity="0.8"/>
    </marker>
  </defs>

  <rect width="860" height="360" fill="url(#dfBg)" rx="14"/>

  <!-- Title -->
  <text x="430" y="36" font-family="Arial, sans-serif" font-size="20" font-weight="bold"
        fill="#c084fc" text-anchor="middle">ğŸ”„  Letter Lifecycle â€” Data Flow</text>
  <line x1="80" y1="48" x2="780" y2="48" stroke="#7C3AED" stroke-width="1" opacity="0.4"/>

  <!-- NODES: row 1 (top flow: Sender side) -->
  <!-- Node 1: User Opens App -->
  <rect x="20" y="75" width="130" height="52" rx="10" fill="#EC4899" opacity="0.2" stroke="#EC4899" stroke-width="1.3"/>
  <text x="85" y="97" font-family="Arial, sans-serif" font-size="12" fill="#f9a8d4" text-anchor="middle" font-weight="bold">ğŸ‘¤ User Opens</text>
  <text x="85" y="116" font-family="Arial, sans-serif" font-size="11" fill="#fce7f3" text-anchor="middle">index.html</text>

  <!-- Arrow 1â†’2 -->
  <line x1="150" y1="101" x2="188" y2="101" stroke="#EC4899" stroke-width="1.5" marker-end="url(#arr)"/>

  <!-- Node 2: Write Letter -->
  <rect x="190" y="75" width="130" height="52" rx="10" fill="#EC4899" opacity="0.2" stroke="#EC4899" stroke-width="1.3"/>
  <text x="255" y="97" font-family="Arial, sans-serif" font-size="12" fill="#f9a8d4" text-anchor="middle" font-weight="bold">âœï¸ Write Letter</text>
  <text x="255" y="116" font-family="Arial, sans-serif" font-size="11" fill="#fce7f3" text-anchor="middle">saveLetter()</text>

  <!-- Arrow 2â†’3 -->
  <line x1="320" y1="101" x2="358" y2="101" stroke="#EC4899" stroke-width="1.5" marker-end="url(#arr)"/>

  <!-- Node 3: Firebase Saves -->
  <rect x="360" y="75" width="130" height="52" rx="10" fill="#F59E0B" opacity="0.2" stroke="#F59E0B" stroke-width="1.3"/>
  <text x="425" y="97" font-family="Arial, sans-serif" font-size="12" fill="#fcd34d" text-anchor="middle" font-weight="bold">ğŸ”¥ Firestore</text>
  <text x="425" y="116" font-family="Arial, sans-serif" font-size="11" fill="#fef3c7" text-anchor="middle">saves letter doc</text>

  <!-- Arrow 3â†’4 -->
  <line x1="490" y1="101" x2="528" y2="101" stroke="#EC4899" stroke-width="1.5" marker-end="url(#arr)"/>

  <!-- Node 4: Code Generated -->
  <rect x="530" y="75" width="130" height="52" rx="10" fill="#7C3AED" opacity="0.25" stroke="#7C3AED" stroke-width="1.3"/>
  <text x="595" y="97" font-family="Arial, sans-serif" font-size="12" fill="#c4b5fd" text-anchor="middle" font-weight="bold">ğŸ”‘ Code Gen</text>
  <text x="595" y="116" font-family="Arial, sans-serif" font-size="11" fill="#ede9fe" text-anchor="middle">6-char unique code</text>

  <!-- Arrow 4â†’5 -->
  <line x1="660" y1="101" x2="698" y2="101" stroke="#EC4899" stroke-width="1.5" marker-end="url(#arr)"/>

  <!-- Node 5: Share -->
  <rect x="700" y="75" width="130" height="52" rx="10" fill="#10B981" opacity="0.2" stroke="#10B981" stroke-width="1.3"/>
  <text x="765" y="97" font-family="Arial, sans-serif" font-size="12" fill="#6ee7b7" text-anchor="middle" font-weight="bold">ğŸ“¤ Share Code</text>
  <text x="765" y="116" font-family="Arial, sans-serif" font-size="11" fill="#d1fae5" text-anchor="middle">WhatsApp / text</text>

  <!-- Connector from Node 5 down to receiver flow -->
  <line x1="765" y1="127" x2="765" y2="185" stroke="#10B981" stroke-width="1.5" stroke-dasharray="4,3" opacity="0.6"/>
  <line x1="765" y1="185" x2="530" y2="185" stroke="#10B981" stroke-width="1.5" stroke-dasharray="4,3" opacity="0.6" marker-end="url(#arrG)"/>

  <!-- RECEIVER FLOW row 2 -->
  <!-- Node 6: Receiver enters code -->
  <rect x="530" y="160" width="130" height="52" rx="10" fill="#2563EB" opacity="0.2" stroke="#2563EB" stroke-width="1.3"/>
  <text x="595" y="182" font-family="Arial, sans-serif" font-size="12" fill="#93c5fd" text-anchor="middle" font-weight="bold">ğŸ”‘ Enter Code</text>
  <text x="595" y="201" font-family="Arial, sans-serif" font-size="11" fill="#dbeafe" text-anchor="middle">fetchLetterByCode()</text>

  <!-- Arrow 6â†’7 -->
  <line x1="530" y1="186" x2="492" y2="186" stroke="#2563EB" stroke-width="1.5" marker-end="url(#arrG)"/>

  <!-- Node 7: Firebase retrieves -->
  <rect x="360" y="160" width="130" height="52" rx="10" fill="#F59E0B" opacity="0.2" stroke="#F59E0B" stroke-width="1.3"/>
  <text x="425" y="182" font-family="Arial, sans-serif" font-size="12" fill="#fcd34d" text-anchor="middle" font-weight="bold">ğŸ”¥ Firestore</text>
  <text x="425" y="201" font-family="Arial, sans-serif" font-size="11" fill="#fef3c7" text-anchor="middle">retrieves letter</text>

  <!-- Arrow 7â†’8 -->
  <line x1="360" y1="186" x2="322" y2="186" stroke="#2563EB" stroke-width="1.5" marker-end="url(#arrG)"/>

  <!-- Node 8: Surprise Page -->
  <rect x="190" y="160" width="130" height="52" rx="10" fill="#EC4899" opacity="0.2" stroke="#EC4899" stroke-width="1.3"/>
  <text x="255" y="182" font-family="Arial, sans-serif" font-size="12" fill="#f9a8d4" text-anchor="middle" font-weight="bold">ğŸ‰ Surprise!</text>
  <text x="255" y="201" font-family="Arial, sans-serif" font-size="11" fill="#fce7f3" text-anchor="middle">valentine.html</text>

  <!-- PUBLIC WALL FLOW row 3 -->
  <line x1="430" y1="64" x2="430" y2="58" stroke="#7C3AED" stroke-width="0.5" opacity="0.3"/>

  <!-- Label separator -->
  <text x="430" y="268" font-family="Arial, sans-serif" font-size="13" fill="#6b7280" text-anchor="middle" font-style="italic">â€” Public Wall (parallel flow) â€”</text>

  <!-- Node P1 -->
  <rect x="120" y="285" width="130" height="48" rx="10" fill="#7C3AED" opacity="0.2" stroke="#7C3AED" stroke-width="1.3"/>
  <text x="185" y="305" font-family="Arial, sans-serif" font-size="12" fill="#c4b5fd" text-anchor="middle" font-weight="bold">ğŸ“ Letter = Public</text>
  <text x="185" y="322" font-family="Arial, sans-serif" font-size="11" fill="#ede9fe" text-anchor="middle">visibility flag set</text>

  <line x1="250" y1="309" x2="288" y2="309" stroke="#7C3AED" stroke-width="1.5" marker-end="url(#arr)"/>

  <!-- Node P2 -->
  <rect x="290" y="285" width="130" height="48" rx="10" fill="#F59E0B" opacity="0.2" stroke="#F59E0B" stroke-width="1.3"/>
  <text x="355" y="305" font-family="Arial, sans-serif" font-size="12" fill="#fcd34d" text-anchor="middle" font-weight="bold">ğŸ”¥ Firestore</text>
  <text x="355" y="322" font-family="Arial, sans-serif" font-size="11" fill="#fef3c7" text-anchor="middle">public_letters col.</text>

  <line x1="420" y1="309" x2="458" y2="309" stroke="#F59E0B" stroke-width="1.5" marker-end="url(#arr)"/>

  <!-- Node P3 -->
  <rect x="460" y="285" width="130" height="48" rx="10" fill="#10B981" opacity="0.2" stroke="#10B981" stroke-width="1.3"/>
  <text x="525" y="305" font-family="Arial, sans-serif" font-size="12" fill="#6ee7b7" text-anchor="middle" font-weight="bold">ğŸŒ Public Wall</text>
  <text x="525" y="322" font-family="Arial, sans-serif" font-size="11" fill="#d1fae5" text-anchor="middle">fetchPublicLetters()</text>

  <line x1="590" y1="309" x2="628" y2="309" stroke="#10B981" stroke-width="1.5" marker-end="url(#arrG)"/>

  <!-- Node P4 -->
  <rect x="630" y="285" width="130" height="48" rx="10" fill="#2563EB" opacity="0.2" stroke="#2563EB" stroke-width="1.3"/>
  <text x="695" y="305" font-family="Arial, sans-serif" font-size="12" fill="#93c5fd" text-anchor="middle" font-weight="bold">â¤ï¸ Likes</text>
  <text x="695" y="322" font-family="Arial, sans-serif" font-size="11" fill="#dbeafe" text-anchor="middle">likeLetter() + localStorage</text>

  <!-- Row labels -->
  <text x="10" y="107" font-family="Arial, sans-serif" font-size="10" fill="#9ca3af" transform="rotate(-90,10,107)">SENDER</text>
  <text x="10" y="190" font-family="Arial, sans-serif" font-size="10" fill="#9ca3af" transform="rotate(-90,10,195)">RECEIVER</text>
</svg>
